---
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import { getPortfolioData } from '../../lib/data';
import { parseMarkdown } from '../../lib/markdown';
import '../../styles/globals.css';

const { slug } = Astro.params;

let portfolioData;
try {
  portfolioData = await getPortfolioData(Astro.locals.runtime.env);
} catch (error) {
  console.error('Error loading data:', error);
  throw error;
}

const post = portfolioData.blogPosts.find(p => p.slug === slug && !p.archived);

if (!post) {
  return Astro.redirect('/blog');
}

function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Layout title={`${post.title} - FemiTaofeeq`} description={post.excerpt}>
  <div class="container mx-auto px-4 py-12">
    <div class="max-w-4xl mx-auto">
      <a href="/blog" class="text-primary hover:underline mb-8 inline-block">
        ← Back to Blog
      </a>
      
      <article>
        <header class="mb-8">
          <h1 class="text-4xl font-bold mb-4">{post.title}</h1>
          <div class="flex items-center space-x-4 text-muted-foreground mb-6">
            <span>By {post.author}</span>
            <span>•</span>
            <span>{formatDate(post.date)}</span>
          </div>
          <img 
            src={post.imageUrl}            alt={post.title}
            class="w-full aspect-video object-cover rounded-lg"
          />
        </header>
        
        <div class="prose prose-lg max-w-none">
          <div set:html={parseMarkdown(post.content)} />
        </div>
      </article>
    </div>
  </div>
</Layout>